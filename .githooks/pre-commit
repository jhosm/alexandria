#!/usr/bin/env node
import { execSync } from 'node:child_process';

function run(label, cmd) {
  console.log(`==> ${label}...`);
  try {
    execSync(cmd, { stdio: 'inherit' });
  } catch {
    process.exit(1);
  }
}

// Format check on staged files only
const staged = execSync('git diff --cached --name-only --diff-filter=ACM', {
  encoding: 'utf8',
}).trim();

if (staged) {
  const files = staged
    .split('\n')
    .map((f) => JSON.stringify(f))
    .join(' ');
  run('Running format check', `npx prettier --check --ignore-unknown ${files}`);
} else {
  console.log('==> Skipping format check (no staged files)');
}

run('Running lint', 'npm run lint');
run('Running type check', 'npx tsc --noEmit');
run('Running tests', 'npm test');
